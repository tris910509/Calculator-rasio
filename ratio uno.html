<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Calculator Rasio & Redaman Fiber Optic</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#f6f7f9}
    .card{border-radius:12px}
    .field-row .form-control[readonly]{background:#ececec}
    .small-muted{font-size:.85rem;color:#6c757d}
    .btn-wide{min-width:140px}
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="mx-auto" style="max-width:980px">
      <div class="card p-4 shadow-sm">
        <h4 class="mb-3">Calculator Rasio & Redaman Fiber Optic</h4>

        <div class="row g-3">
          <!-- Left column inputs -->
          <div class="col-md-6">
            <div class="mb-2">
              <label class="form-label">ASUMSI POWER LASER (dBm)</label>
              <input type="number" id="laserPower" class="form-control" placeholder="contoh: 0 (dBm)" step="0.1" value="0">
            </div>

            <div class="mb-2">
              <label class="form-label">Panjang Kabel (meter)</label>
              <input type="number" id="cableLength" class="form-control" placeholder="contoh: 1000" value="1000" step="1">
              <div class="small-muted">Masukkan jarak kabel dari OLT ke ODP (meter)</div>
            </div>

            <div class="mb-2">
              <label class="form-label">Rasio Kecil (splitter 1:N)</label>
              <select id="smallRatio" class="form-select">
                <option value="0">Tidak ada</option>
                <option value="4">1:4</option>
                <option value="8">1:8</option>
                <option value="16">1:16</option>
                <option value="32">1:32</option>
              </select>
            </div>

            <div class="mb-2">
              <label class="form-label">Rasio Besar (splitter 1:N)</label>
              <select id="bigRatio" class="form-select">
                <option value="0">Tidak ada</option>
                <option value="32">1:32</option>
                <option value="64">1:64</option>
                <option value="128">1:128</option>
              </select>
            </div>

            <div class="mb-2">
              <label class="form-label">Toleransi (dB)</label>
              <input type="number" id="tolerance" class="form-control" placeholder="contoh: 3" step="0.1" value="3">
              <div class="small-muted">Tambahan margin/toleransi jaringan</div>
            </div>

            <div class="mb-2">
              <label class="form-label">Receiver Sensitivity (dBm)</label>
              <input type="number" id="rxSensitivity" class="form-control" placeholder="contoh: -28" step="0.1" value="-28">
              <div class="small-muted">Nilai sensitivitas penerima (mis. ONT)</div>
            </div>
          </div>

          <!-- Right column inputs -->
          <div class="col-md-6">
            <div class="mb-2">
              <label class="form-label">Loss Kabel (dB / meter)</label>
              <input type="number" id="lossPerMeter" class="form-control" placeholder="contoh: 0.0002 (dB/m)" step="0.0001" value="0.0002">
              <div class="small-muted">Contoh singlemode ~0.0002 dB/m (0.2 dB/km)</div>
            </div>

            <div class="mb-2 row g-2">
              <div class="col-7">
                <label class="form-label">Jumlah Splicing</label>
                <input type="number" id="spliceCount" class="form-control" placeholder="contoh: 5" value="5" step="1">
              </div>
              <div class="col-5">
                <label class="form-label">Loss Splicing (dB)</label>
                <input type="number" id="lossPerSplice" class="form-control" placeholder="0.1" step="0.01" value="0.1">
              </div>
            </div>

            <div class="mb-2 row g-2">
              <div class="col-7">
                <label class="form-label">Jumlah Konektor</label>
                <input type="number" id="connectorCount" class="form-control" placeholder="contoh: 2" value="2" step="1">
              </div>
              <div class="col-5">
                <label class="form-label">Loss Konektor (dB)</label>
                <input type="number" id="lossPerConnector" class="form-control" placeholder="0.5" step="0.01" value="0.5">
              </div>
            </div>

            <div class="mb-2 row g-2">
              <div class="col-7">
                <label class="form-label">Tipe ODP</label>
                <select id="odpType" class="form-select">
                  <option value="0">Pilih ODP (tanpa loss)</option>
                  <option value="0.5">ODP Type A (0.5 dB)</option>
                  <option value="1.0">ODP Type B (1.0 dB)</option>
                  <option value="1.5">ODP Type C (1.5 dB)</option>
                </select>
              </div>
              <div class="col-5">
                <label class="form-label">Loss ODP (dB)</label>
                <input type="number" id="lossOdp" class="form-control" readonly value="0">
              </div>
            </div>
          </div>
        </div>

        <hr>

        <!-- Buttons -->
        <div class="d-flex gap-3">
          <button id="btnCalc" class="btn btn-primary btn-wide">HITUNG</button>
          <button id="btnReset" class="btn btn-outline-secondary btn-wide">RESET</button>
          <button id="btnCopy" class="btn btn-outline-success">Copy Hasil</button>
        </div>

        <hr>

        <!-- Results -->
        <div class="row g-3 field-row">
          <div class="col-md-6">
            <label class="form-label">HASIL TOTAL REDAMAN (dB)</label>
            <input type="text" id="totalLoss" class="form-control" readonly value="0">
          </div>

          <div class="col-md-6">
            <label class="form-label">HASIL REDAMAN KELUARAN ODP (dB)</label>
            <input type="text" id="lossAfterOdp" class="form-control" readonly value="0">
          </div>

          <div class="col-md-6">
            <label class="form-label">RECEIVED POWER (dBm)</label>
            <input type="text" id="rxPower" class="form-control" readonly value="0">
            <div class="small-muted">Laser dBm - total redaman</div>
          </div>

          <div class="col-md-6">
            <label class="form-label">MARGIN TERHADAP SENSITIVITY (dB)</label>
            <input type="text" id="margin" class="form-control" readonly value="0">
          </div>

          <div class="col-md-12 mt-2">
            <div id="resultSummary" class="p-3 rounded" style="background:#f1f7ff"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
  // helper
  const $ = id => document.getElementById(id);

  function calcSplitterLoss(N){
    // approximate splitter loss = 10*log10(N) + insertion_loss_per_splitter (approx 0.7 dB)
    if(!N || N<=1) return 0;
    const insertion = 0.7;
    const loss = 10 * Math.log10(N) + insertion;
    return Number(loss.toFixed(2));
  }

  function calc(){
    // read inputs
    const laser = parseFloat($('laserPower').value) || 0;
    const length = parseFloat($('cableLength').value) || 0;
    const lossPerM = parseFloat($('lossPerMeter').value) || 0;
    const spliceCount = parseInt($('spliceCount').value) || 0;
    const lossPerSplice = parseFloat($('lossPerSplice').value) || 0;
    const connCount = parseInt($('connectorCount').value) || 0;
    const lossPerConn = parseFloat($('lossPerConnector').value) || 0;
    const odpLoss = parseFloat($('lossOdp').value) || 0;
    const smallN = parseInt($('smallRatio').value) || 0;
    const bigN = parseInt($('bigRatio').value) || 0;
    const tol = parseFloat($('tolerance').value) || 0;
    const rxSens = parseFloat($('rxSensitivity').value);

    // per-component losses
    const cableLoss = length * lossPerM; // dB
    const spliceLoss = spliceCount * lossPerSplice;
    const connLoss = connCount * lossPerConn;

    // splitter losses (if both used, they add)
    const smallSplitterLoss = calcSplitterLoss(smallN);
    const bigSplitterLoss = calcSplitterLoss(bigN);

    // total losses
    let totalLoss = cableLoss + spliceLoss + connLoss + odpLoss + smallSplitterLoss + bigSplitterLoss + tol;
    totalLoss = Number(totalLoss.toFixed(3));

    // loss after ODP (assume ODP sits before customer, so "keluaran ODP" = losses up to ODP)
    // We'll assume ODP is at end of feeder: so losses up to ODP = cable + splice + conn + smallSplitterLoss + bigSplitterLoss + tol (exclude odpLoss itself)
    const lossUpToOdp = Number((cableLoss + spliceLoss + connLoss + smallSplitterLoss + bigSplitterLoss + tol).toFixed(3));
    const lossAfterOdp = Number((totalLoss).toFixed(3)); // total includes odpLoss

    // received power (dBm)
    const rxPower = Number((laser - totalLoss).toFixed(2));

    // margin against sensitivity
    const margin = Number((rxPower - rxSens).toFixed(2));

    // update outputs
    $('totalLoss').value = totalLoss + ' dB';
    $('lossAfterOdp').value = lossAfterOdp + ' dB';
    $('rxPower').value = rxPower + ' dBm';
    $('margin').value = margin + ' dB';

    // summary message
    let summary = `
      <strong>Ringkasan:</strong>
      <div class="small-muted">Cable loss: ${cableLoss.toFixed(3)} dB ( ${length} m × ${lossPerM} dB/m )</div>
      <div class="small-muted">Splice: ${spliceCount} × ${lossPerSplice} dB → ${spliceLoss.toFixed(3)} dB</div>
      <div class="small-muted">Connector: ${connCount} × ${lossPerConn} dB → ${connLoss.toFixed(3)} dB</div>
      <div class="small-muted">Splitter loss (kecil ${smallN>0?`1:${smallN}`:'-'}): ${smallSplitterLoss} dB</div>
      <div class="small-muted">Splitter loss (besar ${bigN>0?`1:${bigN}`:'-'}): ${bigSplitterLoss} dB</div>
      <div class="small-muted">ODP loss: ${odpLoss} dB</div>
      <div class="small-muted">Toleransi tambahan: ${tol} dB</div>
      <hr>
      <div class="small-muted">Total redaman: <strong>${totalLoss} dB</strong></div>
      <div class="small-muted">Received power: <strong>${rxPower} dBm</strong></div>
      <div class="small-muted">Receiver sensitivity: <strong>${rxSens} dBm</strong></div>
      <div class="small-muted">Margin: <strong>${margin} dB</strong></div>
    `;

    if(margin < 0){
      summary += `<div class="text-danger mt-2"><strong>PERINGATAN:</strong> Margin negatif — link tidak aman, perlu optimasi (kurangi redaman atau naikkan power/ubah rasio).</div>`;
    } else if(margin < 3){
      summary += `<div class="text-warning mt-2"><strong>CATATAN:</strong> Margin kecil (&lt;3 dB) — disarankan menambah margin atau turunkan redaman.</div>`;
    } else {
      summary += `<div class="text-success mt-2"><strong>OK:</strong> Margin memadai.</div>`;
    }

    $('resultSummary').innerHTML = summary;
    // scroll to result
    $('resultSummary').scrollIntoView({behavior:'smooth'});
  }

  // synchronize ODP dropdown with read-only field
  $('odpType').addEventListener('change', e=>{
    const v = parseFloat(e.target.value) || 0;
    $('lossOdp').value = v;
  });

  // buttons
  $('btnCalc').addEventListener('click', calc);
  $('btnReset').addEventListener('click', ()=>{
    // reset to defaults
    $('laserPower').value = 0;
    $('cableLength').value = 1000;
    $('lossPerMeter').value = 0.0002;
    $('spliceCount').value = 5;
    $('lossPerSplice').value = 0.1;
    $('connectorCount').value = 2;
    $('lossPerConnector').value = 0.5;
    $('odpType').value = "0";
    $('lossOdp').value = 0;
    $('smallRatio').value = "0";
    $('bigRatio').value = "0";
    $('tolerance').value = 3;
    $('rxSensitivity').value = -28;
    $('totalLoss').value = '0';
    $('lossAfterOdp').value = '0';
    $('rxPower').value = '0';
    $('margin').value = '0';
    $('resultSummary').innerHTML = '';
  });

  // copy results to clipboard
  $('btnCopy').addEventListener('click', ()=>{
    const txt = [
      'Total Loss: ' + $('totalLoss').value,
      'Loss after ODP: ' + $('lossAfterOdp').value,
      'Received Power: ' + $('rxPower').value,
      'Margin: ' + $('margin').value,
      '',
      'Calculated at: ' + new Date().toLocaleString()
    ].join('\\n');
    navigator.clipboard.writeText(txt).then(()=> alert('Hasil disalin ke clipboard'));
  });

  // press enter to calculate
  document.addEventListener('keypress', (e)=>{ if(e.key==='Enter') { calc(); } });

  // init default
  window.addEventListener('load', ()=>{ $('odpType').dispatchEvent(new Event('change')); });
</script>
</body>
</html>
